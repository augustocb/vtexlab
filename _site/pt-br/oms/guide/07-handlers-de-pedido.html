<h1>Handlers do Pedido</h1>

<h1>OMS Order Handler</h1>

<h2>Visão Geral</h2>

<p><strong><em>Handler</em></strong> de pedidos é uma forma de estender a plataforma <strong><em>Smart Checkout</em></strong> de forma que um pedido, ou melhor, os itens do pedido possam ser manipulados de forma individual e customizada
Neste documento, você vai entender como é  funcionamento do <em>pipeline</em> de handler e qual deve ser o comportamento um <em>handler extension</em> para tratar os itens de pedidos da forma que mais lhe for conveniente.
Este documento pressupõe que você tenha um conhecimento básico de como se integrar com a API do <strong><em>Smart Checkout</em></strong>, principalmente a API do <strong>OMS</strong>.</p>

<blockquote>
<p><strong>NOTA:</strong></p>

<ul>
<li>É importante notar que o <em>pipeline</em> só sera executado após a aprovação do pagamento do pedido</li>
</ul>
</blockquote>

<h4><i class="icon-file"></i> <em>Handler Pipeline</em></h4>

<p>O maior poder da extensibilidade de handler é quando ele está em um contexto de pipeline, ou seja, onde se tem mais de um handler para tratamento de itens. 
A plataforma irá chamar a executação de um handler na forma de um pipeline na ordem definida para cada handler no setup da loja no Smart Checkout.</p>

<h4><i class="icon-cog"></i> Configuração</h4>

<p>TODO</p>

<h4><i class="icon-refresh"></i> Fluxo de execução do <em>Pipeline</em></h4>

<p>O início da execução do pipeline acontece no momento que o pedido chega no status <em>handling</em>. Neste momento será postado um objeto (que chamamos de <em>HandlerRequest</em>) para o primeiro <em>handler</em> do <em>pipelline</em>. </p>

<p>O fluxo de execução do <em>pipeline</em> ocorre como se segue abaixo:</p>

<p><p align="center">
<img src="/images/handlerPipeline.png" alt="enter image description here"></p>

<ol>
<li><p><strong><em>Call Handler</em></strong>: O pipeline server irá postar o objeto <em>HandlerRequest</em> no <em>endpoint</em> do <em>handler</em>. O objeto contêm o número do pedido, endpoint do <em>pipeline</em> para <em>callback</em>, <em>LockId</em> e um objeto chamado de <em>packings</em>. O objeto &quot;_packings_&quot; é composto por uma lista de “caixas abertas” que contêm inicialmente os itens do pedido original.</p></li>
<li><p><strong>Processamento do <em>Handler</em></strong>: Basicamente o <em>handler</em> pode executar 4 diferentes ações ao receber o request:</p>

<ul>
<li>Devolver o(s) pacote(s): O <em>handler</em> verificar que nenhum item é de seu interesse, então ele devolve o pacote para o <em>pipeline</em>.</li>
<li>Fechar o(s) pacote(s): O <em>handler</em> verificar que todo os items é de seu interesse, então ele fecha o pacote  e devolve-o ao pipeline. Fechar o pacote é simplesmente setar o status de um <em>Packing</em> para <em>CLOSED</em>.</li>
<li>Modificar o(s) pacote(s): O <em>Handler</em> pode modificar os itens que compõe um pacote, deixando-o aberto ou fechado.</li>
<li>Criar novo(s) pacote(s): O <em>Handler</em> pode requisitar ao <em>pipeline</em> que crie uma novo &quot;Pacote Vazia&quot;. Com o pacote em mãos o handler pode executar todas as operações descritas anteriormente.</li>
</ul></li>
<li><p><strong>Confirmando a execução do <em>Handler</em></strong>:  O último passo do handler é confirmar o processamento do <em>HandlerRequest</em>. A confirmação é simplesmente a devolução das da lista de <em>packing (packings)</em> para o <em>pipeline</em> através de um <em>POST</em> com o objeto  <em>HandlerResponse</em> no endereço de <em>callback</em> do pipeline. Além das packings o objeto <em>HandlerResponse</em> deverá conter o <em>lockId</em>. Tanto as <em>packings</em>  quanto o <em>lockId</em> são fornecdos junto ao <em>HandlerRequest</em>.</p></li>
<li><p><strong>Passando para o proximo <em>Handler</em></strong>:  O passos acima se repetem para cada handller configurado no <em>pipeline</em> desde que ainda restem “Pacotes abertos” (alguma <em>packing</em> com status <em>OPENED</em>).</p></li>
<li><p><strong>Reexecutando o <em>Pipeline</em></strong>:  Caso o último handler do <em>pipeline</em> ainda devolva  algum “Pacote aberta” (alguma packing com status <em>OPENED</em>) a execução do <em>pipeline</em> volta ao seu inicio. Esse ciclo se repete até que todos os “pacotes” estejam fechadas.</p></li>
</ol>

<h2>Recebendo pedidos através de um Handler</h2>

<p>O primeiro passo é implentar um serviço com interface <em>REST</em>. O <em>pipeline server</em> enviará uma solicitação <em>POST</em> para a URL configurada para a loja, conforme descrito na seção <a href="#Configura%C3%A7%C3%A3o"><em>configuração</em></a>, com um objeto <em>HandlerRequest</em> conforme exemplo a seguir: </p>

<blockquote>
<p><strong>Observação:</strong></p>

<ul>
<li>Tanto a URL do handler (<code>http://api.anystore.com.br/orders/digital-handler</code>) quando a URL do pipeline server (<code>http://oms.vtexcommerce.com.br/api/oms/pvt/handlers/handler-teste/v609192bdev-01?an=anystore</code>) são endereços fictícios.</li>
</ul>
</blockquote>

<h5>Exemplo de Request</h5>

<h6>Request URL:</h6>

<p><em>POST</em> <code>http://api.anystore.com.br/orders/digital-handler</code> </p>

<p><em>Request POST Body</em></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{
  &quot;orderId&quot;: &quot;v609192bdev-01&quot;,
  &quot;plpEndpoint&quot;: &quot;http://oms.vtexcommerce.com.br/api/oms/pvt/handlers/handler-teste/v609192bdev-01?an=anystore&quot;,
  &quot;packings&quot;: [
    {
      &quot;sequence&quot;: 609192,
      &quot;state&quot;: &quot;OPENED&quot;,
      &quot;items&quot;: [
        {
          &quot;logisticsInfo&quot;: {
            &quot;itemIndex&quot;: 0,
            &quot;selectedSla&quot;: &quot;testegravarfrete&quot;,
            &quot;lockTTL&quot;: &quot;9d&quot;,
            &quot;price&quot;: 6000,
            &quot;deliveryWindow&quot;: null,
            &quot;deliveryCompany&quot;: &quot;Brasil&quot;,
            &quot;shippingEstimate&quot;: &quot;9d&quot;,
            &quot;shippingEstimateDate&quot;: &quot;2014-02-05T16:18:01.0459475Z&quot;,
            &quot;slas&quot;: [
              {
                &quot;id&quot;: &quot;testegravarfrete&quot;,
                &quot;name&quot;: &quot;testegravarfrete&quot;,
                &quot;shippingEstimate&quot;: &quot;9d&quot;,
                &quot;deliveryWindow&quot;: null,
                &quot;price&quot;: 6000
              }
            ],
            &quot;shipsTo&quot;: [
              &quot;BRA&quot;
            ],
            &quot;sellingPrice&quot;: 6000,
            &quot;deliveryIds&quot;: [
              {
                &quot;courierId&quot;: &quot;07C1C262-F2D2-46D3-819B-AB9C80731F0D&quot;,
                &quot;dockId&quot;: &quot;FE9702EE-57D1-48BD-9B27-F7686754CB3D&quot;,
                &quot;quantity&quot;: 1,
                &quot;warehouseId&quot;: &quot;B9906D37-E815-47EB-A74B-580203206562&quot;,
                &quot;courierName&quot;: &quot;Brasil&quot;
              }
            ]
          },
          &quot;id&quot;: &quot;2389945&quot;,
          &quot;productId&quot;: &quot;9429046&quot;,
          &quot;lockId&quot;: &quot;00-v609192bdev-01&quot;,
          &quot;quantity&quot;: 1,
          &quot;seller&quot;: &quot;1&quot;,
          &quot;name&quot;: &quot;Celular Desbloqueado LG A290 Tri Chip Branco, Câmera 1.3 MP, MP3 Player, Rádio FM, Fone de Ouvido, Cartão de 2GB&quot;,
          &quot;refId&quot;: &quot;celular&quot;,
          &quot;price&quot;: 19900,
          &quot;listPrice&quot;: 19900,
          &quot;priceTags&quot;: [],
          &quot;imageUrl&quot;: &quot;/arquivos/ids/168582-55-55/1584_1.jpg&quot;,
          &quot;components&quot;: [],
          &quot;bundleItems&quot;: [],
          &quot;params&quot;: [],
          &quot;offerings&quot;: [],
          &quot;sellerSku&quot;: &quot;2389945&quot;,
          &quot;priceValidUntil&quot;: null,
          &quot;commission&quot;: 0,
          &quot;tax&quot;: 0,
          &quot;preSaleDate&quot;: null,
          &quot;additionalInfo&quot;: {
            &quot;brandName&quot;: &quot;Marca Três&quot;,
            &quot;brandId&quot;: &quot;2000001&quot;,
            &quot;categoriesIds&quot;: &quot;/56/&quot;,
            &quot;productClusterId&quot;: &quot;173,182,190&quot;,
            &quot;commercialConditionId&quot;: &quot;1&quot;
          },
          &quot;measurementUnit&quot;: &quot;un&quot;,
          &quot;unitMultiplier&quot;: 1,
          &quot;sellingPrice&quot;: 19900,
          &quot;isGift&quot;: false
        }
      ],
      &quot;date&quot;: &quot;2014-01-27T18:19:21.3100023Z&quot;
    }
  ],
  &quot;lockId&quot;: &quot;5e052d87-2742-4b6a-8ca7-47f2a9b527d7&quot;
}
</code></pre></div>
<p><em>Response: N/A</em></p>

<p>Quando a requisição for bem sucedida, o código de resposta HTTP deverá ser <strong>2xx (sucesso)</strong>.</p>

<p>O segundo passo é  fazer o processamento do itens e executar uma das ações possíveis de acordo com o que foi descrito no fluxo de processamento do <em>pipeline</em>:</p>

<h4><em>Devolver o(s) pacote (s)</em></h4>

<p>Caso o handler verifique que nenhum item recebido deva ser manipulado por ele, é obrigatório que ele devolva os pacotes ao <em>pipeline server</em>. Para isto baste enviar um PUT para plpEndpoint com um objeto <em>packingList</em>.</p>

<ul>
<li><b><code>packingList</code></b> Objeto similar os packingList do <em>HandlerRequest</em> porém sem os campos <em>orderId</em> e <em>plpEndpoint</em>.</li>
</ul>

<h5>Exemplo de Request</h5>

<h6>Request URL:</h6>

<p><em>PUT</em> <code>http://oms.vtexcommerce.com.br/api/oms/pvt/handlers/handler-teste/v609192bdev-01?an=anystore</code> </p>

<p><em>Request PUT Body</em></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{
  &quot;packingList&quot;: [
    {
      &quot;state&quot;: &quot;CLOSED&quot;,
      &quot;sequence&quot;: 609192,
      &quot;items&quot;: [
        {
          &quot;logisticsInfo&quot;: {
            &quot;itemIndex&quot;: 0,
            &quot;selectedSla&quot;: &quot;testegravarfrete&quot;,
            &quot;lockTTL&quot;: &quot;9d&quot;,
            &quot;price&quot;: 6000,
            &quot;deliveryWindow&quot;: null,
            &quot;deliveryCompany&quot;: &quot;Brasil&quot;,
            &quot;shippingEstimate&quot;: &quot;9d&quot;,
            &quot;shippingEstimateDate&quot;: &quot;2014-02-05T16:18:01.0459475Z&quot;,
            &quot;slas&quot;: [
              {
                &quot;id&quot;: &quot;testegravarfrete&quot;,
                &quot;name&quot;: &quot;testegravarfrete&quot;,
                &quot;shippingEstimate&quot;: &quot;9d&quot;,
                &quot;deliveryWindow&quot;: null,
                &quot;price&quot;: 6000
              }
            ],
            &quot;shipsTo&quot;: [
              &quot;BRA&quot;
            ],
            &quot;sellingPrice&quot;: 6000,
            &quot;deliveryIds&quot;: [
              {
                &quot;courierId&quot;: &quot;07C1C262-F2D2-46D3-819B-AB9C80731F0D&quot;,
                &quot;dockId&quot;: &quot;FE9702EE-57D1-48BD-9B27-F7686754CB3D&quot;,
                &quot;quantity&quot;: 1,
                &quot;warehouseId&quot;: &quot;B9906D37-E815-47EB-A74B-580203206562&quot;,
                &quot;courierName&quot;: &quot;Brasil&quot;
              }
            ]
          },
          &quot;id&quot;: &quot;2389945&quot;,
          &quot;productId&quot;: &quot;9429046&quot;,
          &quot;lockId&quot;: &quot;00-v609192bdev-01&quot;,
          &quot;quantity&quot;: 1,
          &quot;seller&quot;: &quot;1&quot;,
          &quot;name&quot;: &quot;Celular Desbloqueado LG A290 Tri Chip Branco, Câmera 1.3 MP, MP3 Player, Rádio FM, Fone de Ouvido, Cartão de 2GB&quot;,
          &quot;refId&quot;: &quot;celular&quot;,
          &quot;price&quot;: 19900,
          &quot;listPrice&quot;: 19900,
          &quot;priceTags&quot;: [],
          &quot;imageUrl&quot;: &quot;/arquivos/ids/168582-55-55/1584_1.jpg&quot;,
          &quot;components&quot;: [],
          &quot;bundleItems&quot;: [],
          &quot;params&quot;: [],
          &quot;offerings&quot;: [],
          &quot;sellerSku&quot;: &quot;2389945&quot;,
          &quot;priceValidUntil&quot;: null,
          &quot;commission&quot;: 0,
          &quot;tax&quot;: 0,
          &quot;preSaleDate&quot;: null,
          &quot;defaultPicker&quot;: null,
          &quot;handlerSequence&quot;: 0,
          &quot;handling&quot;: false,
          &quot;additionalInfo&quot;: {
            &quot;brandName&quot;: &quot;Marca Três&quot;,
            &quot;brandId&quot;: &quot;2000001&quot;,
            &quot;categoriesIds&quot;: &quot;/56/&quot;,
            &quot;productClusterId&quot;: &quot;173,182,190&quot;,
            &quot;commercialConditionId&quot;: &quot;1&quot;
          },
          &quot;measurementUnit&quot;: &quot;un&quot;,
          &quot;unitMultiplier&quot;: 1,
          &quot;sellingPrice&quot;: 19900,
          &quot;isGift&quot;: false
        }
      ],
      &quot;date&quot;: &quot;2014-01-27T18:19:21.3100023Z&quot;
    }
  ],
  &quot;lockId&quot;: &quot;5e052d87-2742-4b6a-8ca7-47f2a9b527d7&quot;
}
</code></pre></div>
<p><em>Response: N/A</em></p>

<h4><em>Fechando o(s) pacote (s) aberto (s)</em></h4>

<p>Caso o handler verifique que todos os itens recebido é de seu interesse, ou seja deva ser processado por ele, a coisa a fazer após o processamento é fechar os pacotes. Para isto simplesmente atribua o valor <strong>CLOSED</strong> ao atributo <em>&quot;state&quot;</em> de cada pacote e enviar uma solicitação de atualização junto ao <em>pipeline server</em> como no exemplo abaixo.</p>

<h5>Exemplo de Request</h5>

<h6>Request URL:</h6>

<p><em>PUT</em> <code>http://oms.vtexcommerce.com.br/api/oms/pvt/handlers/handler-teste/v609192bdev-01?an=anystore</code> </p>

<p><em>Request PUT Body</em></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{
  &quot;orderId&quot;: &quot;v609192bdev-01&quot;,
  &quot;plpEndpoint&quot;: &quot;http://oms.vtexcommerce.com.br/api/oms/pvt/handlers/handler-teste/v609192bdev-01?an=anystore&quot;,
  &quot;packings&quot;: [
    {
      &quot;sequence&quot;: 609192,
      &quot;state&quot;: &quot;CLOSED&quot;,
      &quot;items&quot;: [
        {
          &quot;logisticsInfo&quot;: {
            &quot;itemIndex&quot;: 0,
            &quot;selectedSla&quot;: &quot;testegravarfrete&quot;,
            &quot;lockTTL&quot;: &quot;9d&quot;,
            &quot;price&quot;: 6000,
            &quot;deliveryWindow&quot;: null,
            &quot;deliveryCompany&quot;: &quot;Brasil&quot;,
            &quot;shippingEstimate&quot;: &quot;9d&quot;,
            &quot;shippingEstimateDate&quot;: &quot;2014-02-05T16:18:01.0459475Z&quot;,
            &quot;slas&quot;: [
              {
                &quot;id&quot;: &quot;testegravarfrete&quot;,
                &quot;name&quot;: &quot;testegravarfrete&quot;,
                &quot;shippingEstimate&quot;: &quot;9d&quot;,
                &quot;deliveryWindow&quot;: null,
                &quot;price&quot;: 6000
              }
            ],
            &quot;shipsTo&quot;: [
              &quot;BRA&quot;
            ],
            &quot;sellingPrice&quot;: 6000,
            &quot;deliveryIds&quot;: [
              {
                &quot;courierId&quot;: &quot;07C1C262-F2D2-46D3-819B-AB9C80731F0D&quot;,
                &quot;dockId&quot;: &quot;FE9702EE-57D1-48BD-9B27-F7686754CB3D&quot;,
                &quot;quantity&quot;: 1,
                &quot;warehouseId&quot;: &quot;B9906D37-E815-47EB-A74B-580203206562&quot;,
                &quot;courierName&quot;: &quot;Brasil&quot;
              }
            ]
          },
          &quot;id&quot;: &quot;2389945&quot;,
          &quot;productId&quot;: &quot;9429046&quot;,
          &quot;lockId&quot;: &quot;00-v609192bdev-01&quot;,
          &quot;quantity&quot;: 1,
          &quot;seller&quot;: &quot;1&quot;,
          &quot;name&quot;: &quot;Celular Desbloqueado LG A290 Tri Chip Branco, Câmera 1.3 MP, MP3 Player, Rádio FM, Fone de Ouvido, Cartão de 2GB&quot;,
          &quot;refId&quot;: &quot;celular&quot;,
          &quot;price&quot;: 19900,
          &quot;listPrice&quot;: 19900,
          &quot;priceTags&quot;: [],
          &quot;imageUrl&quot;: &quot;/arquivos/ids/168582-55-55/1584_1.jpg&quot;,
          &quot;components&quot;: [],
          &quot;bundleItems&quot;: [],
          &quot;params&quot;: [],
          &quot;offerings&quot;: [],
          &quot;sellerSku&quot;: &quot;2389945&quot;,
          &quot;priceValidUntil&quot;: null,
          &quot;commission&quot;: 0,
          &quot;tax&quot;: 0,
          &quot;preSaleDate&quot;: null,
          &quot;additionalInfo&quot;: {
            &quot;brandName&quot;: &quot;Marca Três&quot;,
            &quot;brandId&quot;: &quot;2000001&quot;,
            &quot;categoriesIds&quot;: &quot;/56/&quot;,
            &quot;productClusterId&quot;: &quot;173,182,190&quot;,
            &quot;commercialConditionId&quot;: &quot;1&quot;
          },
          &quot;measurementUnit&quot;: &quot;un&quot;,
          &quot;unitMultiplier&quot;: 1,
          &quot;sellingPrice&quot;: 19900,
          &quot;isGift&quot;: false
        }
      ],
      &quot;date&quot;: &quot;2014-01-27T18:19:21.3100023Z&quot;
    }
  ],
  &quot;lockId&quot;: &quot;5e052d87-2742-4b6a-8ca7-47f2a9b527d7&quot;
}
</code></pre></div>
<p><em>Response: N/A</em></p>

<h4><em>Modificar o (s) pacote (s)</em></h4>

<p>Caso o handler verifique que algum dos itens (mas não todos) de um ou mais pacotes é de sua responsabilidade, será necessário solicitar ao <em>pipeline server</em> a criação de um ou mais pacotes VAZIOS de acordo com o que o handler desejar fazer com os itens.</p>

<h5><em>Solicitar criação de pacote (s)</em></h5>

<blockquote>
<p>O retorno desse serviço é uma simples lista com números que o handler deverá atribuir ao -&gt;<em>sequence</em> o qual identifica unicamente cada pacote.
No exemplo abaixo será solicitado a criação de um pacote (quantity = 1).</p>
</blockquote>

<h5>Exemplo de Request</h5>

<h6>Request URL:</h6>

<p><em>POST</em> <code>http://oms.vtexcommerce.com.br/api/oms/pvt/handlers/handler-teste/v609192bdev-01?an=anystore</code> </p>

<p><em>Request POST Body</em></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{
    &quot;lockId&quot; : &quot;5e052d87-2742-4b6a-8ca7-47f2a9b527d7&quot;,
    &quot;quantity&quot; : 1
}
</code></pre></div>
<p><em>Response:</em></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[{1057182}]
</code></pre></div>
<h5><em>Adicionar o (s) pacote (s) ao objeto packings</em></h5>

<blockquote>
<p>Para cada pacote solicitado, criar um objeto conforme modelo abaixo. Setar o <em>sequece</em>  e o <em>state</em> e os <em>items</em>.
<code>
{
      &quot;state&quot;: &quot;OPENED&quot;,
      &quot;sequence&quot;: 1057182,
      &quot;items&quot;: [
        {
          &quot;logisticsInfo&quot;: {
            &quot;itemIndex&quot;: 0,
            &quot;selectedSla&quot;: &quot;testegravarfrete&quot;,
            &quot;lockTTL&quot;: &quot;9d&quot;,
            &quot;price&quot;: 6000,
            &quot;deliveryWindow&quot;: null,
            &quot;deliveryCompany&quot;: &quot;Brasil&quot;,
            &quot;shippingEstimate&quot;: &quot;9d&quot;,
            &quot;shippingEstimateDate&quot;: &quot;2014-02-05T16:18:01.0459475Z&quot;,
            &quot;slas&quot;: [
              {
                &quot;id&quot;: &quot;testegravarfrete&quot;,
                &quot;name&quot;: &quot;testegravarfrete&quot;,
                &quot;shippingEstimate&quot;: &quot;9d&quot;,
                &quot;deliveryWindow&quot;: null,
                &quot;price&quot;: 6000
              }
            ],
            &quot;shipsTo&quot;: [
              &quot;BRA&quot;
            ],
            &quot;sellingPrice&quot;: 6000,
            &quot;deliveryIds&quot;: [
              {
                &quot;courierId&quot;: &quot;07C1C262-F2D2-46D3-819B-AB9C80731F0D&quot;,
                &quot;dockId&quot;: &quot;FE9702EE-57D1-48BD-9B27-F7686754CB3D&quot;,
                &quot;quantity&quot;: 1,
                &quot;warehouseId&quot;: &quot;B9906D37-E815-47EB-A74B-580203206562&quot;,
                &quot;courierName&quot;: &quot;Brasil&quot;
              }
            ]
          },
          &quot;id&quot;: &quot;1234567&quot;,
          &quot;productId&quot;: &quot;9876543&quot;,
          &quot;lockId&quot;: &quot;00-v609192bdev-01&quot;,
          &quot;quantity&quot;: 1,
          &quot;seller&quot;: &quot;1&quot;,
          &quot;name&quot;: &quot;Capa de celular&quot;,
          &quot;refId&quot;: &quot;Capa celular&quot;,
          &quot;price&quot;: 1,
          &quot;listPrice&quot;: 1,
          &quot;priceTags&quot;: [],
          &quot;imageUrl&quot;: &quot;/arquivos/ids/168582-55-55/1584_1.jpg&quot;,
          &quot;components&quot;: [],
          &quot;bundleItems&quot;: [],
          &quot;params&quot;: [],
          &quot;offerings&quot;: [],
          &quot;sellerSku&quot;: &quot;3389948&quot;,
          &quot;priceValidUntil&quot;: null,
          &quot;commission&quot;: 0,
          &quot;tax&quot;: 0,
          &quot;preSaleDate&quot;: null,
          &quot;defaultPicker&quot;: null,
          &quot;handlerSequence&quot;: 0,
          &quot;handling&quot;: false,
          &quot;additionalInfo&quot;: {
            &quot;brandName&quot;: &quot;Marca Três&quot;,
            &quot;brandId&quot;: &quot;2000001&quot;,
            &quot;categoriesIds&quot;: &quot;/56/&quot;,
            &quot;productClusterId&quot;: &quot;173,182,190&quot;,
            &quot;commercialConditionId&quot;: &quot;1&quot;
          },
          &quot;measurementUnit&quot;: &quot;un&quot;,
          &quot;unitMultiplier&quot;: 1,
          &quot;sellingPrice&quot;: 1,
          &quot;isGift&quot;: true
        }
      ]
    }
</code></p>
</blockquote>

<h5><em>Comitar as mudanças (s)</em></h5>

<blockquote>
<p>No exemplo será enviado ao <em>pipeline server</em> um pacote aberto e outro fechado.</p>
</blockquote>

<h5>Exemplo de Request</h5>

<h6>Request URL:</h6>

<p><em>PUT</em> <code>http://oms.vtexcommerce.com.br/api/oms/pvt/handlers/handler-teste/v609192bdev-01?an=anystore</code> </p>

<p><em>Request PUT Body</em></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{
  &quot;packingList&quot;: [
    {
      &quot;state&quot;: &quot;CLOSED&quot;,
      &quot;sequence&quot;: 609192,
      &quot;items&quot;: [
        {
          &quot;logisticsInfo&quot;: {
            &quot;itemIndex&quot;: 0,
            &quot;selectedSla&quot;: &quot;testegravarfrete&quot;,
            &quot;lockTTL&quot;: &quot;9d&quot;,
            &quot;price&quot;: 6000,
            &quot;deliveryWindow&quot;: null,
            &quot;deliveryCompany&quot;: &quot;Brasil&quot;,
            &quot;shippingEstimate&quot;: &quot;9d&quot;,
            &quot;shippingEstimateDate&quot;: &quot;2014-02-05T16:18:01.0459475Z&quot;,
            &quot;slas&quot;: [
              {
                &quot;id&quot;: &quot;testegravarfrete&quot;,
                &quot;name&quot;: &quot;testegravarfrete&quot;,
                &quot;shippingEstimate&quot;: &quot;9d&quot;,
                &quot;deliveryWindow&quot;: null,
                &quot;price&quot;: 6000
              }
            ],
            &quot;shipsTo&quot;: [
              &quot;BRA&quot;
            ],
            &quot;sellingPrice&quot;: 6000,
            &quot;deliveryIds&quot;: [
              {
                &quot;courierId&quot;: &quot;07C1C262-F2D2-46D3-819B-AB9C80731F0D&quot;,
                &quot;dockId&quot;: &quot;FE9702EE-57D1-48BD-9B27-F7686754CB3D&quot;,
                &quot;quantity&quot;: 1,
                &quot;warehouseId&quot;: &quot;B9906D37-E815-47EB-A74B-580203206562&quot;,
                &quot;courierName&quot;: &quot;Brasil&quot;
              }
            ]
          },
          &quot;id&quot;: &quot;2389945&quot;,
          &quot;productId&quot;: &quot;9429046&quot;,
          &quot;lockId&quot;: &quot;00-v609192bdev-01&quot;,
          &quot;quantity&quot;: 1,
          &quot;seller&quot;: &quot;1&quot;,
          &quot;name&quot;: &quot;Celular Desbloqueado LG A290 Tri Chip Branco, Câmera 1.3 MP, MP3 Player, Rádio FM, Fone de Ouvido, Cartão de 2GB&quot;,
          &quot;refId&quot;: &quot;celular&quot;,
          &quot;price&quot;: 19900,
          &quot;listPrice&quot;: 19900,
          &quot;priceTags&quot;: [],
          &quot;imageUrl&quot;: &quot;/arquivos/ids/168582-55-55/1584_1.jpg&quot;,
          &quot;components&quot;: [],
          &quot;bundleItems&quot;: [],
          &quot;params&quot;: [],
          &quot;offerings&quot;: [],
          &quot;sellerSku&quot;: &quot;2389945&quot;,
          &quot;priceValidUntil&quot;: null,
          &quot;commission&quot;: 0,
          &quot;tax&quot;: 0,
          &quot;preSaleDate&quot;: null,
          &quot;defaultPicker&quot;: null,
          &quot;handlerSequence&quot;: 0,
          &quot;handling&quot;: false,
          &quot;additionalInfo&quot;: {
            &quot;brandName&quot;: &quot;Marca Três&quot;,
            &quot;brandId&quot;: &quot;2000001&quot;,
            &quot;categoriesIds&quot;: &quot;/56/&quot;,
            &quot;productClusterId&quot;: &quot;173,182,190&quot;,
            &quot;commercialConditionId&quot;: &quot;1&quot;
          },
          &quot;measurementUnit&quot;: &quot;un&quot;,
          &quot;unitMultiplier&quot;: 1,
          &quot;sellingPrice&quot;: 19900,
          &quot;isGift&quot;: false
        }
      ],
      &quot;date&quot;: &quot;2014-01-27T18:19:21.3100023Z&quot;
    },
    {
      &quot;state&quot;: &quot;OPENED&quot;,
      &quot;sequence&quot;: 1057182,
      &quot;items&quot;: [
        {
          &quot;logisticsInfo&quot;: {
            &quot;itemIndex&quot;: 0,
            &quot;selectedSla&quot;: &quot;testegravarfrete&quot;,
            &quot;lockTTL&quot;: &quot;9d&quot;,
            &quot;price&quot;: 6000,
            &quot;deliveryWindow&quot;: null,
            &quot;deliveryCompany&quot;: &quot;Brasil&quot;,
            &quot;shippingEstimate&quot;: &quot;9d&quot;,
            &quot;shippingEstimateDate&quot;: &quot;2014-02-05T16:18:01.0459475Z&quot;,
            &quot;slas&quot;: [
              {
                &quot;id&quot;: &quot;testegravarfrete&quot;,
                &quot;name&quot;: &quot;testegravarfrete&quot;,
                &quot;shippingEstimate&quot;: &quot;9d&quot;,
                &quot;deliveryWindow&quot;: null,
                &quot;price&quot;: 6000
              }
            ],
            &quot;shipsTo&quot;: [
              &quot;BRA&quot;
            ],
            &quot;sellingPrice&quot;: 6000,
            &quot;deliveryIds&quot;: [
              {
                &quot;courierId&quot;: &quot;07C1C262-F2D2-46D3-819B-AB9C80731F0D&quot;,
                &quot;dockId&quot;: &quot;FE9702EE-57D1-48BD-9B27-F7686754CB3D&quot;,
                &quot;quantity&quot;: 1,
                &quot;warehouseId&quot;: &quot;B9906D37-E815-47EB-A74B-580203206562&quot;,
                &quot;courierName&quot;: &quot;Brasil&quot;
              }
            ]
          },
          &quot;id&quot;: &quot;1234567&quot;,
          &quot;productId&quot;: &quot;9876543&quot;,
          &quot;lockId&quot;: &quot;00-v609192bdev-01&quot;,
          &quot;quantity&quot;: 1,
          &quot;seller&quot;: &quot;1&quot;,
          &quot;name&quot;: &quot;Capa de celular&quot;,
          &quot;refId&quot;: &quot;Capa celular&quot;,
          &quot;price&quot;: 1,
          &quot;listPrice&quot;: 1,
          &quot;priceTags&quot;: [],
          &quot;imageUrl&quot;: &quot;/arquivos/ids/168582-55-55/1584_1.jpg&quot;,
          &quot;components&quot;: [],
          &quot;bundleItems&quot;: [],
          &quot;params&quot;: [],
          &quot;offerings&quot;: [],
          &quot;sellerSku&quot;: &quot;3389948&quot;,
          &quot;priceValidUntil&quot;: null,
          &quot;commission&quot;: 0,
          &quot;tax&quot;: 0,
          &quot;preSaleDate&quot;: null,
          &quot;defaultPicker&quot;: null,
          &quot;handlerSequence&quot;: 0,
          &quot;handling&quot;: false,
          &quot;additionalInfo&quot;: {
            &quot;brandName&quot;: &quot;Marca Três&quot;,
            &quot;brandId&quot;: &quot;2000001&quot;,
            &quot;categoriesIds&quot;: &quot;/56/&quot;,
            &quot;productClusterId&quot;: &quot;173,182,190&quot;,
            &quot;commercialConditionId&quot;: &quot;1&quot;
          },
          &quot;measurementUnit&quot;: &quot;un&quot;,
          &quot;unitMultiplier&quot;: 1,
          &quot;sellingPrice&quot;: 1,
          &quot;isGift&quot;: true
        }
      ]
    }
  ],
  &quot;lockId&quot;: &quot;5e052d87-2742-4b6a-8ca7-47f2a9b527d7&quot;
}
</code></pre></div>
<p><em>Response: N/A</em></p>
